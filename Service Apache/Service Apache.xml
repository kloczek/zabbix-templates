<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>3.4</version>
  <date>2018-06-11T11:38:49Z</date>
  <groups>
    <group>
      <name>Templates</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Service Apache</template>
      <name>Service Apache</name>
      <description>Apache service monitoring template using zabbix active agent items.&#13;
&#13;
Version : 1.0.4 (2018-06-11)&#13;
URL: https://github.com/kloczek/zabbix-templates/tree/master/Service%20Apache&#13;
&#13;
Notes:&#13;
- This template uses apache mod_status metrics.&#13;
- To use this template in apache configuration needs to be added:&#13;
&#13;
ExtendedStatus On&#13;
&lt;Location /server-status&gt;&#13;
 SetHandler server-status&#13;
 Order deny,allow&#13;
 Deny from all&#13;
 Allow from localhost&#13;
&lt;/Location&gt;</description>
      <groups>
        <group>
          <name>Templates</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>SVC::Apache</name>
        </application>
      </applications>
      <items>
        <item>
          <name>SVC::$1</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>net.tcp.service[http,,{$HTTP_SERVICE_PORT}]</key>
          <delay>1m</delay>
          <history>2w</history>
          <trends>365d</trends>
          <status>0</status>
          <value_type>3</value_type>
          <allowed_hosts/>
          <units/>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description/>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap>
            <name>Service state</name>
          </valuemap>
          <logtimefmt/>
          <preprocessing/>
          <jmx_endpoint/>
          <master_item/>
        </item>
        <item>
          <name>PROC::$1</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>proc.num[httpd]</key>
          <delay>30s</delay>
          <history>2w</history>
          <trends>365d</trends>
          <status>0</status>
          <value_type>3</value_type>
          <allowed_hosts/>
          <units>processes</units>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description/>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap/>
          <logtimefmt/>
          <preprocessing/>
          <jmx_endpoint/>
          <master_item/>
        </item>
        <item>
          <name>Workers::busy</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"BusyWorkers: ([0-9]+)",,\1]</key>
          <delay>30s</delay>
          <history>2w</history>
          <trends>365d</trends>
          <status>0</status>
          <value_type>3</value_type>
          <allowed_hosts/>
          <units>processes</units>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description/>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap/>
          <logtimefmt/>
          <preprocessing/>
          <jmx_endpoint/>
          <master_item/>
        </item>
        <item>
          <name>Workers::idle</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"IdleWorkers: ([0-9]+)",,\1]</key>
          <delay>30s</delay>
          <history>2w</history>
          <trends>365d</trends>
          <status>0</status>
          <value_type>3</value_type>
          <allowed_hosts/>
          <units>processes</units>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description/>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap/>
          <logtimefmt/>
          <preprocessing/>
          <jmx_endpoint/>
          <master_item/>
        </item>
        <item>
          <name>ServerMPM</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"ServerMPM: (.+)",,\1]</key>
          <delay>30s</delay>
          <history>2w</history>
          <trends>0</trends>
          <status>0</status>
          <value_type>1</value_type>
          <allowed_hosts/>
          <units/>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description>Apache httpd MPM type.&#13;
Possible values:&#13;
* event&#13;
* prefork&#13;
* worker</description>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap/>
          <logtimefmt/>
          <preprocessing/>
          <jmx_endpoint/>
          <master_item/>
        </item>
        <item>
          <name>Uptime</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"ServerUptimeSeconds: ([0-9]+)",,\1]</key>
          <delay>5m</delay>
          <history>2w</history>
          <trends>365d</trends>
          <status>0</status>
          <value_type>3</value_type>
          <allowed_hosts/>
          <units>uptime</units>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description>The Apache server uptime.</description>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap/>
          <logtimefmt/>
          <preprocessing/>
          <jmx_endpoint/>
          <master_item/>
        </item>
        <item>
          <name>ServerVersion</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"ServerVersion: (.+)",,\1]</key>
          <delay>30s</delay>
          <history>2w</history>
          <trends>0</trends>
          <status>0</status>
          <value_type>1</value_type>
          <allowed_hosts/>
          <units/>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description>Apache server version string.</description>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap/>
          <logtimefmt/>
          <preprocessing/>
          <jmx_endpoint/>
          <master_item/>
        </item>
        <item>
          <name>Requests</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"Total Accesses: ([0-9]+)",,\1]</key>
          <delay>30s</delay>
          <history>2w</history>
          <trends>365d</trends>
          <status>0</status>
          <value_type>0</value_type>
          <allowed_hosts/>
          <units>r/s</units>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description>HTTP requests per second.</description>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap/>
          <logtimefmt/>
          <preprocessing>
            <step>
              <type>10</type>
              <params/>
            </step>
          </preprocessing>
          <jmx_endpoint/>
          <master_item/>
        </item>
        <item>
          <name>Transfer</name>
          <type>7</type>
          <snmp_community/>
          <snmp_oid/>
          <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"Total kBytes: ([0-9]+)",,\1]</key>
          <delay>30s</delay>
          <history>2w</history>
          <trends>365d</trends>
          <status>0</status>
          <value_type>0</value_type>
          <allowed_hosts/>
          <units>B/s</units>
          <snmpv3_contextname/>
          <snmpv3_securityname/>
          <snmpv3_securitylevel>0</snmpv3_securitylevel>
          <snmpv3_authprotocol>0</snmpv3_authprotocol>
          <snmpv3_authpassphrase/>
          <snmpv3_privprotocol>0</snmpv3_privprotocol>
          <snmpv3_privpassphrase/>
          <params/>
          <ipmi_sensor/>
          <authtype>0</authtype>
          <username/>
          <password/>
          <publickey/>
          <privatekey/>
          <port/>
          <description>Data transferred in B/s.</description>
          <inventory_link>0</inventory_link>
          <applications>
            <application>
              <name>SVC::Apache</name>
            </application>
          </applications>
          <valuemap/>
          <logtimefmt/>
          <preprocessing>
            <step>
              <type>10</type>
              <params/>
            </step>
            <step>
              <type>1</type>
              <params>1024</params>
            </step>
          </preprocessing>
          <jmx_endpoint/>
          <master_item/>
        </item>
      </items>
      <discovery_rules/>
      <httptests/>
      <macros>
        <macro>
          <macro>{$HTTP_SERVICE_PORT}</macro>
          <value>80</value>
        </macro>
      </macros>
      <templates/>
      <screens>
        <screen>
          <name>SVC::Apache</name>
          <hsize>1</hsize>
          <vsize>3</vsize>
          <screen_items>
            <screen_item>
              <resourcetype>0</resourcetype>
              <width>900</width>
              <height>200</height>
              <x>0</x>
              <y>0</y>
              <colspan>1</colspan>
              <rowspan>1</rowspan>
              <elements>0</elements>
              <valign>1</valign>
              <halign>1</halign>
              <style>0</style>
              <url/>
              <dynamic>0</dynamic>
              <sort_triggers>0</sort_triggers>
              <resource>
                <name>SVC::Apache::requests</name>
                <host>Service Apache</host>
              </resource>
              <max_columns>3</max_columns>
              <application/>
            </screen_item>
            <screen_item>
              <resourcetype>0</resourcetype>
              <width>900</width>
              <height>200</height>
              <x>0</x>
              <y>1</y>
              <colspan>1</colspan>
              <rowspan>1</rowspan>
              <elements>0</elements>
              <valign>1</valign>
              <halign>1</halign>
              <style>0</style>
              <url/>
              <dynamic>0</dynamic>
              <sort_triggers>0</sort_triggers>
              <resource>
                <name>SVC::Apache::processes</name>
                <host>Service Apache</host>
              </resource>
              <max_columns>3</max_columns>
              <application/>
            </screen_item>
            <screen_item>
              <resourcetype>0</resourcetype>
              <width>900</width>
              <height>200</height>
              <x>0</x>
              <y>2</y>
              <colspan>1</colspan>
              <rowspan>1</rowspan>
              <elements>0</elements>
              <valign>1</valign>
              <halign>1</halign>
              <style>0</style>
              <url/>
              <dynamic>0</dynamic>
              <sort_triggers>0</sort_triggers>
              <resource>
                <name>SVC::Apache::workers</name>
                <host>Service Apache</host>
              </resource>
              <max_columns>3</max_columns>
              <application/>
            </screen_item>
          </screen_items>
        </screen>
      </screens>
    </template>
  </templates>
  <triggers>
    <trigger>
      <expression>{Service Apache:proc.num[httpd].min(#3)}&gt;100</expression>
      <recovery_mode>0</recovery_mode>
      <recovery_expression/>
      <name>PROC::httpd::too many processes running ({ITEM.LASTVALUE} processes)</name>
      <correlation_mode>0</correlation_mode>
      <correlation_tag/>
      <url/>
      <status>0</status>
      <priority>3</priority>
      <description/>
      <type>0</type>
      <manual_close>0</manual_close>
      <dependencies/>
      <tags/>
    </trigger>
    <trigger>
      <expression>{Service Apache:proc.num[httpd].max(#8)}=0</expression>
      <recovery_mode>0</recovery_mode>
      <recovery_expression/>
      <name>PROC::httpd is not running</name>
      <correlation_mode>0</correlation_mode>
      <correlation_tag/>
      <url/>
      <status>0</status>
      <priority>3</priority>
      <description/>
      <type>0</type>
      <manual_close>0</manual_close>
      <dependencies/>
      <tags/>
    </trigger>
    <trigger>
      <expression>{Service Apache:net.tcp.service[http,,{$HTTP_SERVICE_PORT}].max(#3)}=0</expression>
      <recovery_mode>0</recovery_mode>
      <recovery_expression/>
      <name>SVC::http tcp/{$HTTP_SERVICE_PORT} is DOWN</name>
      <correlation_mode>0</correlation_mode>
      <correlation_tag/>
      <url/>
      <status>0</status>
      <priority>3</priority>
      <description>Nothing listens on http tcp/{$HTTP_SERVICE_PORT} port or traffic on this port is filtered by firewall.</description>
      <type>0</type>
      <manual_close>0</manual_close>
      <dependencies/>
      <tags/>
    </trigger>
  </triggers>
  <graphs>
    <graph>
      <name>SVC::Apache::processes</name>
      <width>1200</width>
      <height>300</height>
      <yaxismin>0.0000</yaxismin>
      <yaxismax>100.0000</yaxismax>
      <show_work_period>1</show_work_period>
      <show_triggers>1</show_triggers>
      <type>0</type>
      <show_legend>1</show_legend>
      <show_3d>0</show_3d>
      <percent_left>0.0000</percent_left>
      <percent_right>0.0000</percent_right>
      <ymin_type_1>1</ymin_type_1>
      <ymax_type_1>0</ymax_type_1>
      <ymin_item_1>0</ymin_item_1>
      <ymax_item_1>0</ymax_item_1>
      <graph_items>
        <graph_item>
          <sortorder>0</sortorder>
          <drawtype>5</drawtype>
          <color>00C800</color>
          <yaxisside>0</yaxisside>
          <calc_fnc>7</calc_fnc>
          <type>0</type>
          <item>
            <host>Service Apache</host>
            <key>proc.num[httpd]</key>
          </item>
        </graph_item>
      </graph_items>
    </graph>
    <graph>
      <name>SVC::Apache::requests</name>
      <width>1200</width>
      <height>300</height>
      <yaxismin>0.0000</yaxismin>
      <yaxismax>100.0000</yaxismax>
      <show_work_period>1</show_work_period>
      <show_triggers>1</show_triggers>
      <type>0</type>
      <show_legend>1</show_legend>
      <show_3d>0</show_3d>
      <percent_left>0.0000</percent_left>
      <percent_right>0.0000</percent_right>
      <ymin_type_1>1</ymin_type_1>
      <ymax_type_1>0</ymax_type_1>
      <ymin_item_1>0</ymin_item_1>
      <ymax_item_1>0</ymax_item_1>
      <graph_items>
        <graph_item>
          <sortorder>0</sortorder>
          <drawtype>2</drawtype>
          <color>00C800</color>
          <yaxisside>0</yaxisside>
          <calc_fnc>7</calc_fnc>
          <type>0</type>
          <item>
            <host>Service Apache</host>
            <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"Total Accesses: ([0-9]+)",,\1]</key>
          </item>
        </graph_item>
      </graph_items>
    </graph>
    <graph>
      <name>SVC::Apache::workers</name>
      <width>1200</width>
      <height>300</height>
      <yaxismin>0.0000</yaxismin>
      <yaxismax>100.0000</yaxismax>
      <show_work_period>1</show_work_period>
      <show_triggers>1</show_triggers>
      <type>1</type>
      <show_legend>1</show_legend>
      <show_3d>0</show_3d>
      <percent_left>0.0000</percent_left>
      <percent_right>0.0000</percent_right>
      <ymin_type_1>1</ymin_type_1>
      <ymax_type_1>0</ymax_type_1>
      <ymin_item_1>0</ymin_item_1>
      <ymax_item_1>0</ymax_item_1>
      <graph_items>
        <graph_item>
          <sortorder>0</sortorder>
          <drawtype>1</drawtype>
          <color>009900</color>
          <yaxisside>0</yaxisside>
          <calc_fnc>2</calc_fnc>
          <type>0</type>
          <item>
            <host>Service Apache</host>
            <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"BusyWorkers: ([0-9]+)",,\1]</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>1</sortorder>
          <drawtype>0</drawtype>
          <color>FFFF33</color>
          <yaxisside>0</yaxisside>
          <calc_fnc>2</calc_fnc>
          <type>0</type>
          <item>
            <host>Service Apache</host>
            <key>web.page.regexp[localhost,server-status?auto,{$HTTP_SERVICE_PORT},"IdleWorkers: ([0-9]+)",,\1]</key>
          </item>
        </graph_item>
      </graph_items>
    </graph>
  </graphs>
  <value_maps>
    <value_map>
      <name>Service state</name>
      <mappings>
        <mapping>
          <value>0</value>
          <newvalue>Down</newvalue>
        </mapping>
        <mapping>
          <value>1</value>
          <newvalue>Up</newvalue>
        </mapping>
      </mappings>
    </value_map>
  </value_maps>
</zabbix_export>
